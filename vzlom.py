from .. import loader, utils
import asyncio


@loader.tds
class FakeHackMod(loader.Module):
    """–§–µ–π–∫–æ–≤—ã–π –≤–∑–ª–æ–º —á–∞—Ç–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ .vzlom"""

    strings = {
        "name": "FakeHack",
    }

    async def client_ready(self, client, db):
        self.client = client

    async def vzlomcmd(self, message):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–µ–π–∫–æ–≤—ã–π –≤–∑–ª–æ–º —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ (30‚Äí40 —Å–µ–∫—É–Ω–¥)"""

        # –®–∞–≥–∏ ¬´–≤–∑–ª–æ–º–∞¬ª –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        steps = [
            ("–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤‚Ä¶", 5),
            ("–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞‚Ä¶", 15),
            ("–£–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤‚Ä¶", 25),
            ("–°–º–µ–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Ç–∞‚Ä¶", 35),
            ("–°–±—Ä–æ—Å –∞–≤–∞—Ç–∞—Ä–∫–∏‚Ä¶", 45),
            ("–ò–Ω—ä–µ–∫—Ü–∏—è –≤–∏—Ä—É—Å–∞ \"–ö–æ—Ç–∏–∫–∏\"‚Ä¶", 55),
            ("–ó–∞–ª–∏–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–æ–≤‚Ä¶", 65),
            ("–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π‚Ä¶", 75),
            ("–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è –≤–∑–ª–æ–º–∞‚Ä¶", 85),
            ("–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è‚Ä¶", 95),
        ]

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        prog_bar_len = 10  # ‚ñì‚ñë –ø–æ–ª–æ—Å–∫–∞ –∏–∑ 10 —Å–∏–º–≤–æ–ª–æ–≤
        msg = await utils.answer(message, "üöÄ –ù–∞—á–∏–Ω–∞—é –≤–∑–ª–æ–º —á–∞—Ç–∞: [‚ñë" * prog_bar_len + "] 0%")

        total_duration = 34  # —Å–µ–∫—É–Ω–¥, –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω 30‚Äì40
        interval = total_duration / (len(steps) + 1)

        # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏–º–∏—Ç–∏—Ä—É—è –ø—Ä–æ–≥—Ä–µ—Å—Å
        for text, pct in steps:
            await asyncio.sleep(interval)
            filled = int(prog_bar_len * pct / 100)
            bar = "‚ñì" * filled + "‚ñë" * (prog_bar_len - filled)
            await msg.edit(f"{text}\n[{bar}] {pct}%")

        # –§–∏–Ω–∞–ª—å–Ω—ã–π 100¬†%
        await asyncio.sleep(interval)
        bar = "‚ñì" * prog_bar_len
        await msg.edit(f"‚úÖ –í–∑–ª–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω!\n[{bar}] 100%")

        # –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —é–∑–µ—Ä–±–æ—Ç–∞
        me = await self.client.get_me()
        owner_mention = f"@{me.username}" if getattr(me, "username", None) else (me.first_name or "–≤–ª–∞–¥–µ–ª–µ—Ü")

        await asyncio.sleep(1)
        await msg.edit(f"{owner_mention}, —É—Å–ø–µ—à–Ω–æ –≤–∑–ª–æ–º–∞–Ω, –ø–æ–ø—É—â–µ–Ω –∏ –≤—ã–µ–±–∞–Ω –≤ –∞–Ω–∞–ª")
